var libApp=angular.module("songLibraryApp",[]);libApp.controller("SongListController",["$scope","$http",function(e,a){var t="https://www.khalemano.com/songlist";function n(){return!!e.pending.title}e.initialLoadErrorMsg="",e.songs={},e.pending={},e.pendingAdd={},e.sortOptions=[{display:"Title (A-Z)",property:"title",reverse:!1},{display:"Title (Z-A)",property:"title",reverse:!0},{display:"Artist (A-Z)",property:"artist",reverse:!1},{display:"Artist (Z-A)",property:"artist",reverse:!0},{display:"Release Date (Oldest-Newest)",property:"releaseDateObj",reverse:!1},{display:"Release Date (Newest-Oldest)",property:"releaseDateObj",reverse:!0},{display:"Price (Lowest-Highest)",property:"price",reverse:!1},{display:"Price (Highest-Lowest)",property:"price",reverse:!0}],e.selectedSortOption=e.sortOptions[0],e.releaseDateRangeStart,e.releaseDateRangeEnd,e.releaseDateRangeValid=!0,e.appliedReleaseDateRangeStart,e.appliedReleaseDateRangeEnd,e.songEditTitleValid=!0,e.songEditModalMode="",e.songEditModalTitle="",e.songForDelete,e.saveInProgress=!1,e.saveStatus="SUCCESS",e.saveStatusMsg=void 0,a.get(t).then(function(a){var t,n;e.songs=(t=a.data,n={},t.forEach(function(e){var a,t,r,s=angular.copy(e),i=s.id;s.releaseDate&&(s.releaseDateObj=(a=s.releaseDate,t=a.split("-").map(e=>parseInt(e)),(r=new Date).setFullYear(t[0],t[1]-1,t[2]),r.setHours(0,0,0,0),r)),n[i]=s}),n)},function(a){e.initialLoadErrorMsg="Error occurred while loading song data.  Please try reloading."}),e.saveSongList=function(){var n,r=(n=Object.values(e.songs).map(function(e){var a={};return a.id=e.id,a.title=e.title,a.artist=e.artist,a.releaseDate=e.releaseDateObj.toISOString().split("T")[0],a.price=e.price,a}),JSON.stringify(n));e.saveInProgress=!0,a.post(t,r,{headers:{"Content-Type":"text/plain"}}).then(function(a){e.saveInProgress=!1,e.saveStatus="SUCCESS",e.saveStatusMsg="SAVED SUCCESSFULLY."},function(a){e.saveInProgress=!1,e.saveStatus="ERROR",e.saveStatusMsg="ERROR OCCURRED WHILE SAVING.  PLEASE TRY AGAIN."})},e.clearSaveStatusMsg=function(){e.saveStatusMsg=void 0},e.applyReleaseDateRange=function(){e.releaseDateRangeValid=!(e.releaseDateRangeStart&&e.releaseDateRangeEnd&&e.releaseDateRangeStart.valueOf()>e.releaseDateRangeEnd.valueOf()),e.releaseDateRangeValid&&(e.appliedReleaseDateRangeStart=e.releaseDateRangeStart,e.appliedReleaseDateRangeEnd=e.releaseDateRangeEnd)},e.releaseDateFilter=function(a){var t=a.releaseDateObj,n=e.appliedReleaseDateRangeStart,r=e.appliedReleaseDateRangeEnd;return!n&&!r||!!t&&(!(n&&n.valueOf()>t.valueOf())&&!(r&&r.valueOf()<t.valueOf()))},e.clearReleaseDateFilter=function(){e.appliedReleaseDateRangeStart=void 0,e.appliedReleaseDateRangeEnd=void 0},e.hasReleaseDateFilter=function(){return!(!e.appliedReleaseDateRangeStart&&!e.appliedReleaseDateRangeEnd)},e.noFiltersApplied=function(){return!e.hasReleaseDateFilter()},e.getSongArray=function(){return Object.values(e.songs)},e.prepModelForDelete=function(a){e.songForDelete=a},e.deleteSong=function(a){delete e.songs[a]},e.prepModalForAdd=function(){e.pending=e.pendingAdd,e.songEditModalMode="ADD",e.songEditModalTitle="Add Song",e.songEditTitleValid=!0},e.commitAdd=function(){if(e.songEditTitleValid=n(),e.songEditTitleValid){var a=function(){for(var a=0;a<3;a++){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=Math.floor(16*Math.random());return("x"==e?a:3&a|8).toString(16)});if(e.songs[t])throw new Error("Failed to generate new song GUID");return t}}(),t=angular.copy(e.pendingAdd);t.id=a,e.songs[a]=t,e.pendingAdd={}}},e.prepModalForUpdate=function(a){e.pending=angular.copy(a),e.songEditModalMode="UPDATE",e.songEditModalTitle="Update Song",e.songEditTitleValid=!0},e.commitUpdate=function(){if(e.songEditTitleValid=n(),e.songEditTitleValid){if(!e.pending.id)throw new Error("Failed to update record due to missing ID");var a=e.pending.id;e.songs[a]=angular.copy(e.pending)}}}]);